'use strict';
sap.ui.define([
    'sap/base/Log',
    '../cpe/init',
    './init-dialogs',
    'open/ux/preview/client/thirdparty/@sap-ux-private/control-property-editor-common',
    './extension-point',
    'sap/ui/VersionInfo',
    './ui5-version-utils'
], function (log, __init, ___init_dialogs, ___sap_ux_private_control_property_editor_common, __ExtensionPointService, VersionInfo, ___ui5_version_utils) {
    'use strict';
    function _interopRequireDefault(obj) {
        return obj && obj.__esModule && typeof obj.default !== 'undefined' ? obj.default : obj;
    }
    const init = _interopRequireDefault(__init);
    const initDialogs = ___init_dialogs['initDialogs'];
    const showMessage = ___sap_ux_private_control_property_editor_common['showMessage'];
    const startPostMessageCommunication = ___sap_ux_private_control_property_editor_common['startPostMessageCommunication'];
    const ExtensionPointService = _interopRequireDefault(__ExtensionPointService);
    const getUI5VersionValidationMessage = ___ui5_version_utils['getUI5VersionValidationMessage'];
    var __exports = async function (rta) {
        const extPointService = new ExtensionPointService(rta);
        const actionHandlers = [];
        function subscribe(handler) {
            actionHandlers.push(handler);
        }
        const {sendAction} = startPostMessageCommunication(window.parent, async function onAction(action) {
            for (const handler of actionHandlers) {
                try {
                    await handler(action);
                } catch (error) {
                    log.error('Handler Failed: ', error);
                }
            }
        });
        initDialogs(rta);
        extPointService.init(subscribe);
        init(rta);
        const ui5Version = await VersionInfo.load();
        const ui5VersionValidationMsg = getUI5VersionValidationMessage(ui5Version.version);
        if (ui5VersionValidationMsg) {
            sendAction(showMessage(ui5VersionValidationMsg));
        }
        log.debug('ADP init executed.');
    };
    return __exports;
});